{{- $recent_num := (.Site.Params.widgets.recent_num | default 10) }}

{{- $recent := where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
{{- $recent = partial "functions/filter-series-posts.html" (dict "pages" $recent) }}

{{- if $recent }}
<div class="widget-recent widget">
    <h4 class="widget__title">{{ T "recent_title" }}</h4>
    <div class="widget__content">
        <ul class="widget__list">
            {{- range first $recent_num $recent }}
            {{- $currentLang := site.Language.Lang }}
            {{- $contentKey := .File.BaseFileName }}
            {{- $title := .Title }}
            
            {{- /* Determinar si es una serie y obtener t√≠tulo apropiado */ -}}
            {{- if and .Params.series (eq .Type "series") }}

                {{- /* Buscar en data de series */ -}}
                {{- $seriesData := index site.Data.series .Params.series }}
                {{- $contentData := index $seriesData $contentKey }}
                {{- if $contentData }}
                    {{- $title = index $contentData.title $currentLang }}
                {{- end }}
            {{- else if site.Data.articles }}
                {{- /* Buscar en data de articles (l√≥gica existente) */ -}}
                {{- range $key, $value := site.Data.articles }}
                    {{- if eq $key $contentKey }}
                        {{- $dataTitle := index $value $currentLang }}
                        {{- if $dataTitle }}
                            {{- $title = $dataTitle }}
                        {{- end }}
                    {{- end }}
                {{- end }}
            {{- end }}
            
            <li class="widget__item">
                <a class="widget__link" href="{{ .RelPermalink }}">
                    {{- if .Params.series }}
                        <span class="series-indicator">üß© </span>
                    {{- end }}
                    {{ $title }}
                </a>
            </li>
            {{- end }}
        </ul>
    </div>
</div>
{{- end }}
